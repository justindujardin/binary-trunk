<!DOCTYPE html>  <html> <head>   <title>binary-trunk.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <ul class="sections">           <li id="title">             <span class="annotation">                 <h1>binary-trunk.coffee</h1>             </span>         </li>                              <li id="section-1">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                                        </span>                      </li>                              <li id="section-2">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>                           

<p><a href="./index.html">binary-trunk</a> makes working with <strong>binary trees</strong> in <em>CoffeeScript</em> and 
<em>Javascript</em> easy by providing a well-equipped <strong><a href="#BinaryTreeNode">tree node</a></strong>, example 
<strong><a href="#BinarySearchTree">search tree</a></strong> implementation, and an excellent <strong><a href="#BinaryTreeTidier">layout algorithm</a></strong>
implementation for visualizing the contents of your trees.</p>

<p>The <a href="https://github.com/justindujardin/binary-trunk">source code</a> is available under the <a href="https://github.com/justindujardin/binary-trunk/blob/master/LICENSE">MIT license</a>, there is 
a <a href="./tests.html">thorough test-suite</a> with accompanying <a href="./binary-trunk.test.html">annotated test-suite code</a></p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nv">root = </span><span class="k">this</span>
<span class="nv">DJC = root.DJC = </span><span class="nx">root</span><span class="p">.</span><span class="nx">DJC</span> <span class="o">or</span> <span class="p">{}</span></pre></div></span>                      </li>                              <li id="section-3">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>                           

<h2>Constants</h2>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nv">DJC.BT = BT =</span></pre></div></span>                      </li>                              <li id="section-4">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>                           

<p>Return this from a node visit function to abort a tree visit.</p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nv">STOP : </span><span class="s">&#39;stop&#39;</span></pre></div></span>                      </li>                              <li id="section-5">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>                           

<p>The constant representing the left child side of a node.</p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nv">LEFT : </span><span class="s">&#39;left&#39;</span></pre></div></span>                      </li>                              <li id="section-6">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>                           

<p>The constant representing the right child side of a node.</p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nv">RIGHT: </span><span class="s">&#39;right&#39;</span></pre></div></span>                      </li>                              <li id="section-7">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>                           

<h2><a id="BinaryTreeNode"></a>BinaryTreeNode</h2>

             </span>                      </li>                              <li id="section-8">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>                           

<p>The binary tree node is the base node for all of our trees, and provides a
rich set of methods for constructing, inspecting, and modifying them.</p>

<p>The node itself defines the structure of the binary tree, having left and right
children, and a parent.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeNode</span></pre></div></span>                      </li>                              <li id="section-9">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>                           

<p>Allow specifying children in the constructor</p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nx">constructor</span><span class="o">:</span><span class="nf">(left,right) -&gt;</span>
    <span class="nx">@setLeft</span> <span class="nx">left</span> <span class="k">if</span> <span class="nx">left</span>
    <span class="nx">@setRight</span> <span class="nx">right</span> <span class="k">if</span> <span class="nx">right</span>
    <span class="nx">@parent</span> <span class="o">?=</span> <span class="kc">undefined</span></pre></div></span>                      </li>                              <li id="section-10">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>                           

<p>Create a clone of this tree</p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nx">clone</span><span class="o">:</span><span class="p">()</span> <span class="nf">-&gt;</span>
    <span class="nv">result = </span><span class="k">new</span> <span class="nx">@</span><span class="p">.</span><span class="nx">constructor</span><span class="p">()</span>  
    <span class="nx">result</span><span class="p">.</span><span class="nx">setLeft</span> <span class="nx">@left</span><span class="p">.</span><span class="nx">clone</span><span class="p">()</span> <span class="k">if</span> <span class="nx">@left</span>
    <span class="nx">result</span><span class="p">.</span><span class="nx">setRight</span> <span class="nx">@right</span><span class="p">.</span><span class="nx">clone</span><span class="p">()</span> <span class="k">if</span> <span class="nx">@right</span>
    <span class="nx">result</span></pre></div></span>                      </li>                              <li id="section-11">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>                           

<p>Is this node a leaf?  A node is a leaf if it has no children.</p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nx">isLeaf</span><span class="o">:</span><span class="p">()</span> <span class="nf">-&gt;</span> <span class="o">not</span> <span class="nx">@left</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">@right</span></pre></div></span>                      </li>                              <li id="section-12">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>                           

<p>Serialize the node as a string</p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nx">toString</span><span class="o">:</span><span class="p">()</span> <span class="nf">-&gt;</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">@left</span><span class="si">}</span><span class="s"> </span><span class="si">#{</span><span class="nx">@right</span><span class="si">}</span><span class="s">&quot;</span></pre></div></span>                      </li>                              <li id="section-13">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>                           

<p>Rotate a node, changing the structure of the tree, without modifying
the order of the nodes in the tree.</p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nx">rotate</span><span class="o">:</span><span class="p">()</span> <span class="nf">-&gt;</span> 
    <span class="nv">node = </span><span class="nx">@</span>
    <span class="nv">parent = </span><span class="nx">@parent</span>
    <span class="k">return</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">node</span> <span class="o">or</span> <span class="o">not</span> <span class="nx">parent</span>
    <span class="nv">grandParent = </span><span class="nx">@parent</span><span class="p">.</span><span class="nx">parent</span>
    <span class="k">if</span> <span class="nx">node</span> <span class="o">==</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">left</span>
      <span class="nx">parent</span><span class="p">.</span><span class="nx">setLeft</span> <span class="nx">node</span><span class="p">.</span><span class="nx">right</span>
      <span class="nv">node.right = </span><span class="nx">parent</span>
      <span class="nv">parent.parent = </span><span class="nx">node</span>
    <span class="k">else</span>
      <span class="nx">parent</span><span class="p">.</span><span class="nx">setRight</span> <span class="nx">node</span><span class="p">.</span><span class="nx">left</span>
      <span class="nv">node.left = </span><span class="nx">parent</span>
      <span class="nv">parent.parent = </span><span class="nx">node</span>
    <span class="nv">node.parent = </span><span class="nx">grandParent</span>
    <span class="k">return</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">grandParent</span>
    <span class="k">if</span> <span class="nx">parent</span> <span class="o">is</span> <span class="nx">grandParent</span><span class="p">.</span><span class="nx">left</span>
      <span class="nv">grandParent.left = </span><span class="nx">node</span>
    <span class="k">else</span>
      <span class="nv">grandParent.right = </span><span class="nx">node</span>
    </pre></div></span>                      </li>                              <li id="section-14">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>                           

<p><strong>Tree Traversal</strong></p>

<p>Each visit method accepts a function that will be invoked for each node in the 
tree.  The callback function is passed three arguments: the node being
visited, the current depth in the tree, and a user specified data parameter.</p>

<p><em>Traversals may be canceled by returning <code>DJC.BT.STOP</code> from any visit function.</em></p>

             </span>                      </li>                              <li id="section-15">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>                           

<p>Preorder : <em>Visit -> Left -> Right</em></p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nx">visitPreorder</span><span class="o">:</span><span class="nf">(visitFunction, depth=0, data) -&gt;</span>
    <span class="k">return</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span> <span class="k">if</span> <span class="nx">visitFunction</span> <span class="o">and</span> <span class="nx">visitFunction</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">depth</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">==</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span>
    <span class="k">return</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span> <span class="k">if</span> <span class="nx">@left</span> <span class="o">and</span> <span class="nx">@left</span><span class="p">.</span><span class="nx">visitPreorder</span><span class="p">(</span><span class="nx">visitFunction</span><span class="p">,</span> <span class="nx">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">==</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span>
    <span class="k">return</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span> <span class="k">if</span> <span class="nx">@right</span> <span class="o">and</span> <span class="nx">@right</span><span class="p">.</span><span class="nx">visitPreorder</span><span class="p">(</span><span class="nx">visitFunction</span><span class="p">,</span> <span class="nx">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">==</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span></pre></div></span>                      </li>                              <li id="section-16">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>                           

<p>Inorder : <em>Left -> Visit -> Right</em></p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nx">visitInorder</span><span class="o">:</span><span class="nf">(visitFunction, depth=0, data) -&gt;</span>
    <span class="k">return</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span> <span class="k">if</span> <span class="nx">@left</span> <span class="o">and</span> <span class="nx">@left</span><span class="p">.</span><span class="nx">visitInorder</span><span class="p">(</span><span class="nx">visitFunction</span><span class="p">,</span> <span class="nx">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nx">data</span><span class="p">)</span> <span class="o">==</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span>
    <span class="k">return</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span> <span class="k">if</span> <span class="nx">visitFunction</span> <span class="o">and</span> <span class="nx">visitFunction</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">depth</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">==</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span>
    <span class="k">return</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span> <span class="k">if</span> <span class="nx">@right</span> <span class="o">and</span> <span class="nx">@right</span><span class="p">.</span><span class="nx">visitInorder</span><span class="p">(</span><span class="nx">visitFunction</span><span class="p">,</span> <span class="nx">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">==</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span></pre></div></span>                      </li>                              <li id="section-17">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>                           

<p>Postorder : <em>Left -> Right -> Visit</em></p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nx">visitPostorder</span><span class="o">:</span><span class="nf">(visitFunction, depth=0, data) -&gt;</span>
    <span class="k">return</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span> <span class="k">if</span> <span class="nx">@left</span> <span class="o">and</span> <span class="nx">@left</span><span class="p">.</span><span class="nx">visitPostorder</span><span class="p">(</span><span class="nx">visitFunction</span><span class="p">,</span> <span class="nx">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">==</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span>
    <span class="k">return</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span> <span class="k">if</span> <span class="nx">@right</span> <span class="o">and</span> <span class="nx">@right</span><span class="p">.</span><span class="nx">visitPostorder</span><span class="p">(</span><span class="nx">visitFunction</span><span class="p">,</span> <span class="nx">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">==</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span>
    <span class="k">return</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span> <span class="k">if</span> <span class="nx">visitFunction</span> <span class="o">and</span> <span class="nx">visitFunction</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">depth</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">==</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span>
  </pre></div></span>                      </li>                              <li id="section-18">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>                           

<p>Return the root element of this tree</p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nx">getRoot</span><span class="o">:</span><span class="p">()</span> <span class="nf">-&gt;</span>
    <span class="nv">result = </span><span class="nx">@</span>
    <span class="nv">result = </span><span class="nx">result</span><span class="p">.</span><span class="nx">parent</span> <span class="k">while</span> <span class="nx">result</span><span class="p">.</span><span class="nx">parent</span>
    <span class="k">return</span> <span class="nx">result</span></pre></div></span>                      </li>                              <li id="section-19">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>                           

<p><strong>Child Management</strong></p>

<p>Methods for setting the children on this expression.  These take care of
making sure that the proper parent assignments also take place.</p>

             </span>                      </li>                              <li id="section-20">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>                           

<p>Set the left node to the passed <code>child</code></p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nx">setLeft</span><span class="o">:</span><span class="nf">(child) -&gt;</span>
    <span class="vi">@left = </span><span class="nx">child</span>
    <span class="nx">@left</span><span class="o">?</span><span class="p">.</span><span class="nv">parent = </span><span class="k">this</span></pre></div></span>                      </li>                              <li id="section-21">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>                           

<p>Set the right node to the passed <code>child</code></p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nx">setRight</span><span class="o">:</span><span class="nf">(child) -&gt;</span>
    <span class="vi">@right = </span><span class="nx">child</span>
    <span class="nx">@right</span><span class="o">?</span><span class="p">.</span><span class="nv">parent = </span><span class="k">this</span></pre></div></span>                      </li>                              <li id="section-22">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>                           

<p>Determine whether the given <code>child</code> is the left or right child of this node</p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nx">getSide</span><span class="o">:</span><span class="nf">(child) -&gt;</span>
    <span class="k">return</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">LEFT</span> <span class="k">if</span> <span class="nx">child</span> <span class="o">==</span> <span class="nx">@left</span>
    <span class="k">return</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">RIGHT</span> <span class="k">if</span> <span class="nx">child</span> <span class="o">==</span> <span class="nx">@right</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;BinaryTreeNode.getSide: not a child of this node&quot;</span></pre></div></span>                      </li>                              <li id="section-23">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>                           

<p>Set a new <code>child</code> on the given <code>side</code></p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nx">setSide</span><span class="o">:</span><span class="nf">(child,side) -&gt;</span>
    <span class="k">switch</span> <span class="nx">side</span>
      <span class="k">when</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">LEFT</span> <span class="k">then</span> <span class="nx">@setLeft</span><span class="p">(</span><span class="nx">child</span><span class="p">)</span>
      <span class="k">when</span> <span class="nx">BT</span><span class="p">.</span><span class="nx">RIGHT</span> <span class="k">then</span> <span class="nx">@setRight</span><span class="p">(</span><span class="nx">child</span><span class="p">)</span>
      <span class="k">else</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;BinaryTreeNode.setSide: Invalid side&quot;</span></pre></div></span>                      </li>                              <li id="section-24">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>                           

<p>Get children as an array.  If there are two children, the first object will 
always represent the left child, and the second will represent the right.</p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nx">getChildren</span><span class="o">:</span><span class="p">()</span> <span class="nf">-&gt;</span>
    <span class="nv">result = </span><span class="p">[]</span>
    <span class="nx">result</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@left</span> <span class="k">if</span> <span class="nx">@left</span>
    <span class="nx">result</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@right</span> <span class="k">if</span> <span class="nx">@right</span>
    <span class="nx">result</span></pre></div></span>                      </li>                              <li id="section-25">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>                           

<p>Get the sibling node of this node.  If there is no parent, or the node has no
sibling, the return value will be undefined.</p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nx">getSibling</span><span class="o">:</span><span class="p">()</span> <span class="nf">-&gt;</span>
    <span class="k">return</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">@parent</span>
    <span class="k">return</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">right</span> <span class="k">if</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">left</span> <span class="o">is</span> <span class="nx">@</span>
    <span class="k">return</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">left</span> <span class="k">if</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">right</span> <span class="o">is</span> <span class="nx">@</span></pre></div></span>                      </li>                              <li id="section-26">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>                           

<h2><a id="BinarySearchTree"></a>BinarySearchTree</h2>

             </span>                      </li>                              <li id="section-27">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>                           

<p>A very simple binary search tree that relies on keys that support 
operator value comparison.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinarySearchTree</span> <span class="k">extends</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeNode</span>
  <span class="nx">constructor</span><span class="o">:</span><span class="nf">(@key) -&gt;</span> <span class="k">super</span><span class="p">()</span>
  <span class="nx">clone</span><span class="o">:</span><span class="p">()</span> <span class="nf">-&gt;</span>
    <span class="nv">result = </span><span class="k">super</span><span class="p">()</span>
    <span class="nv">result.key = </span><span class="nx">@key</span>
    <span class="nx">result</span></pre></div></span>                      </li>                              <li id="section-28">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>                           

<p>Insert a node in the tree with the specified key.</p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nx">insert</span><span class="o">:</span><span class="nf">(key) -&gt;</span>
    <span class="nv">node = </span><span class="nx">@getRoot</span><span class="p">()</span>
    <span class="k">while</span> <span class="nx">node</span>
      <span class="k">if</span> <span class="nx">key</span> <span class="o">&gt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">key</span>
        <span class="k">if</span> <span class="o">not</span> <span class="nx">node</span><span class="p">.</span><span class="nx">right</span>
          <span class="nx">node</span><span class="p">.</span><span class="nx">setRight</span> <span class="k">new</span> <span class="nx">BinarySearchTree</span> <span class="nx">key</span>
          <span class="k">break</span>
        <span class="nv">node = </span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">key</span> <span class="o">&lt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">key</span> 
        <span class="k">if</span> <span class="o">not</span> <span class="nx">node</span><span class="p">.</span><span class="nx">left</span> 
          <span class="nx">node</span><span class="p">.</span><span class="nx">setLeft</span> <span class="k">new</span> <span class="nx">BinarySearchTree</span> <span class="nx">key</span>
          <span class="k">break</span>
        <span class="nv">node = </span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span>
      <span class="k">else</span>
        <span class="k">break</span>
    <span class="nx">@</span></pre></div></span>                      </li>                              <li id="section-29">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>                           

<p>Find a node in the tree by its key and return it.  Return null if the key
is not found in the tree.</p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nx">find</span><span class="o">:</span><span class="nf">(key) -&gt;</span>
    <span class="nv">node = </span><span class="nx">@getRoot</span><span class="p">()</span>
    <span class="k">while</span> <span class="nx">node</span> 
      <span class="k">if</span> <span class="nx">key</span> <span class="o">&gt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">key</span>
        <span class="k">return</span> <span class="kc">null</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">node</span><span class="p">.</span><span class="nx">right</span>
        <span class="nv">node = </span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span>
        <span class="k">continue</span>
      <span class="k">if</span> <span class="nx">key</span> <span class="o">&lt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">key</span>
        <span class="k">return</span> <span class="kc">null</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">node</span><span class="p">.</span><span class="nx">left</span>
        <span class="nv">node = </span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span>
        <span class="k">continue</span>
      <span class="k">return</span> <span class="nx">node</span> <span class="k">if</span> <span class="nx">key</span> <span class="o">==</span> <span class="nx">node</span><span class="p">.</span><span class="nx">key</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="kc">null</span></pre></div></span>                      </li>                              <li id="section-30">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>                           

<h2><a id="BinaryTreeTidier"></a>BinaryTreeTidier</h2>

             </span>                      </li>                              <li id="section-31">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>                           

<p>Implement a Reingold-Tilford 'tidier' tree layout algorithm.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeTidier</span></pre></div></span>                      </li>                              <li id="section-32">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>                           

<p>Assign x/y values to all nodes in the tree, and return an object containing
the measurements of the tree.</p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nv">layout: </span><span class="nf">(node,unitMultiplier=1) -&gt;</span>
    <span class="nx">@measure</span> <span class="nx">node</span>
    <span class="nx">@transform</span> <span class="nx">node</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">unitMultiplier</span></pre></div></span>                      </li>                              <li id="section-33">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>                           

<p>Computer relative tree node positions</p>

             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nv">measure: </span><span class="nf">(node, level=0, extremes) -&gt;</span>
    <span class="nx">extremes</span> <span class="o">?=</span> <span class="nv">left: </span><span class="kc">null</span><span class="p">,</span> <span class="nv">right: </span><span class="kc">null</span><span class="p">,</span> <span class="nx">level</span><span class="o">:</span><span class="mi">0</span></pre></div></span>                      </li>                              <li id="section-34">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>                           

<p>left and right subtree extreme leaf nodes</p>

             </span>                          <span class="content"><div class="highlight"><pre>    <span class="nv">leftExtremes = left: </span><span class="kc">null</span><span class="p">,</span> <span class="nv">right: </span><span class="kc">null</span><span class="p">,</span> <span class="nx">level</span><span class="o">:</span><span class="mi">0</span>
    <span class="nv">rightExtremes = left: </span><span class="kc">null</span><span class="p">,</span> <span class="nv">right: </span><span class="kc">null</span><span class="p">,</span> <span class="nx">level</span><span class="o">:</span><span class="mi">0</span></pre></div></span>                      </li>                              <li id="section-35">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>                           

<p>separation at the root of the current subtree, as well as at the current level.</p>

             </span>                          <span class="content"><div class="highlight"><pre>    <span class="nv">currentSeparation = </span><span class="mi">0</span>
    <span class="nv">rootSeparation = </span><span class="mi">0</span>
    <span class="nv">minimumSeparation = </span><span class="mi">1</span></pre></div></span>                      </li>                              <li id="section-36">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>                           

<p>The offset from left/right children to the root of the current subtree.</p>

             </span>                          <span class="content"><div class="highlight"><pre>    <span class="nv">leftOffsetSum = </span><span class="mi">0</span>
    <span class="nv">rightOffsetSum = </span><span class="mi">0</span></pre></div></span>                      </li>                              <li id="section-37">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>                           

<p>Avoid selecting as extreme</p>

             </span>                          <span class="content"><div class="highlight"><pre>    <span class="k">if</span> <span class="o">not</span> <span class="nx">node</span>
      <span class="nx">extremes</span><span class="p">.</span><span class="nx">left</span><span class="o">?</span><span class="p">.</span><span class="nv">level = </span><span class="o">-</span><span class="mi">1</span>
      <span class="nx">extremes</span><span class="p">.</span><span class="nx">right</span><span class="o">?</span><span class="p">.</span><span class="nv">level = </span><span class="o">-</span><span class="mi">1</span>
      <span class="k">return</span></pre></div></span>                      </li>                              <li id="section-38">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>                           

<p>Assign the <code>node.y</code>, note the left/right child nodes, and recurse into the tree.</p>

             </span>                          <span class="content"><div class="highlight"><pre>    <span class="nv">node.y = </span><span class="nx">level</span>
    <span class="nv">left = </span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span>
    <span class="nv">right = </span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span>
    <span class="nx">@measure</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">level</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">leftExtremes</span>
    <span class="nx">@measure</span> <span class="nx">right</span><span class="p">,</span> <span class="nx">level</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">rightExtremes</span></pre></div></span>                      </li>                              <li id="section-39">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>                           

<p>A leaf is both the leftmost and rightmost node on the lowest level of the 
subtree consisting of itself.</p>

             </span>                          <span class="content"><div class="highlight"><pre>    <span class="k">if</span> <span class="o">not</span> <span class="nx">node</span><span class="p">.</span><span class="nx">right</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">node</span><span class="p">.</span><span class="nx">left</span>
      <span class="nv">node.offset = </span><span class="mi">0</span>
      <span class="nv">extremes.right = extremes.left = </span><span class="nx">node</span>
      <span class="k">return</span> <span class="nx">extremes</span></pre></div></span>                      </li>                              <li id="section-40">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>                           

<p>if only a single child, assign the next available offset and return.  </p>

<p>TODO: I'm not sure this is correct.  Visual inspection of layout tree is needed to verify. </p>

             </span>                          <span class="content"><div class="highlight"><pre>    <span class="k">if</span> <span class="o">not</span> <span class="nx">node</span><span class="p">.</span><span class="nx">right</span> <span class="o">or</span> <span class="o">not</span> <span class="nx">node</span><span class="p">.</span><span class="nx">left</span>
      <span class="nv">node.offset = </span><span class="nx">minimumSeparation</span>
      <span class="nv">extremes.right = extremes.left = </span><span class="k">if</span> <span class="nx">node</span><span class="p">.</span><span class="nx">left</span> <span class="k">then</span> <span class="nx">node</span><span class="p">.</span><span class="nx">left</span> <span class="k">else</span> <span class="nx">node</span><span class="p">.</span><span class="nx">right</span>
      <span class="k">return</span></pre></div></span>                      </li>                              <li id="section-41">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>                           

<p>Set the current separation to the minimum separation for the root of the
subtree.</p>

             </span>                          <span class="content"><div class="highlight"><pre>    <span class="nv">currentSeparation = </span><span class="nx">minimumSeparation</span>
    <span class="nv">leftOffsetSum = rightOffsetSum = </span><span class="mi">0</span></pre></div></span>                      </li>                              <li id="section-42">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>                           

<p>Traverse the subtrees until one of them is exhausted, pushing them apart 
as needed.</p>

             </span>                          <span class="content"><div class="highlight"><pre>    <span class="nv">loops = </span><span class="mi">0</span>
    <span class="k">while</span> <span class="nx">left</span> <span class="o">and</span> <span class="nx">right</span> 
      <span class="nx">loops</span><span class="o">++</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;An impossibly large tree perhaps?&quot;</span> <span class="k">if</span> <span class="nx">loops</span> <span class="o">&gt;</span> <span class="mi">100000</span>
      <span class="k">if</span> <span class="nx">currentSeparation</span> <span class="o">&lt;</span> <span class="nx">minimumSeparation</span> 
        <span class="nx">rootSeparation</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">minimumSeparation</span> <span class="o">-</span> <span class="nx">currentSeparation</span><span class="p">)</span>
        <span class="nv">currentSeparation = </span><span class="nx">minimumSeparation</span>

      <span class="k">if</span> <span class="nx">left</span><span class="p">.</span><span class="nx">right</span>
        <span class="nx">leftOffsetSum</span> <span class="o">+=</span> <span class="nx">left</span><span class="p">.</span><span class="nx">offset</span>
        <span class="nx">currentSeparation</span> <span class="o">-=</span> <span class="nx">left</span><span class="p">.</span><span class="nx">offset</span>
        <span class="nv">left = </span><span class="nx">left</span><span class="p">.</span><span class="nx">thread</span> <span class="o">or</span> <span class="nx">left</span><span class="p">.</span><span class="nx">right</span>
      <span class="k">else</span>
        <span class="nx">leftOffsetSum</span> <span class="o">-=</span> <span class="nx">left</span><span class="p">.</span><span class="nx">offset</span>
        <span class="nx">currentSeparation</span> <span class="o">+=</span> <span class="nx">left</span><span class="p">.</span><span class="nx">offset</span>
        <span class="nv">left = </span><span class="nx">left</span><span class="p">.</span><span class="nx">thread</span> <span class="o">or</span> <span class="nx">left</span><span class="p">.</span><span class="nx">left</span>

      <span class="k">if</span> <span class="nx">right</span><span class="p">.</span><span class="nx">left</span>
        <span class="nx">rightOffsetSum</span> <span class="o">-=</span> <span class="nx">right</span><span class="p">.</span><span class="nx">offset</span> 
        <span class="nx">currentSeparation</span> <span class="o">-=</span> <span class="nx">right</span><span class="p">.</span><span class="nx">offset</span>
        <span class="nv">right = </span><span class="nx">right</span><span class="p">.</span><span class="nx">thread</span> <span class="o">or</span> <span class="nx">right</span><span class="p">.</span><span class="nx">left</span>
      <span class="k">else</span>
        <span class="nx">rightOffsetSum</span> <span class="o">+=</span> <span class="nx">right</span><span class="p">.</span><span class="nx">offset</span> 
        <span class="nx">currentSeparation</span> <span class="o">+=</span> <span class="nx">right</span><span class="p">.</span><span class="nx">offset</span>
        <span class="nv">right = </span><span class="nx">right</span><span class="p">.</span><span class="nx">thread</span> <span class="o">or</span> <span class="nx">right</span><span class="p">.</span><span class="nx">right</span></pre></div></span>                      </li>                              <li id="section-43">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>                           

<p>Set the root offset, and include it in the accumulated offsets.</p>

             </span>                          <span class="content"><div class="highlight"><pre>    <span class="nv">node.offset = </span><span class="p">(</span><span class="nx">rootSeparation</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="nx">leftOffsetSum</span> <span class="o">-=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">offset</span>
    <span class="nx">rightOffsetSum</span> <span class="o">+=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">offset</span></pre></div></span>                      </li>                              <li id="section-44">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>                           

<p>Update right and left extremes</p>

             </span>                          <span class="content"><div class="highlight"><pre>    <span class="k">if</span> <span class="nx">rightExtremes</span><span class="p">.</span><span class="nx">left</span><span class="p">.</span><span class="nx">level</span> <span class="o">&gt;</span> <span class="nx">leftExtremes</span><span class="p">.</span><span class="nx">left</span><span class="p">.</span><span class="nx">level</span> <span class="o">or</span> <span class="o">not</span> <span class="nx">node</span><span class="p">.</span><span class="nx">left</span>
      <span class="nv">extremes.left = </span><span class="nx">rightExtremes</span><span class="p">.</span><span class="nx">left</span>
      <span class="nx">extremes</span><span class="p">.</span><span class="nx">left</span><span class="p">.</span><span class="nx">offset</span> <span class="o">+=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">offset</span>
    <span class="k">else</span>
      <span class="nv">extremes.left = </span><span class="nx">leftExtremes</span><span class="p">.</span><span class="nx">left</span>
      <span class="nx">extremes</span><span class="p">.</span><span class="nx">left</span><span class="p">.</span><span class="nx">offset</span> <span class="o">-=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">offset</span>
    <span class="k">if</span> <span class="nx">leftExtremes</span><span class="p">.</span><span class="nx">right</span><span class="p">.</span><span class="nx">level</span> <span class="o">&gt;</span> <span class="nx">rightExtremes</span><span class="p">.</span><span class="nx">right</span><span class="p">.</span><span class="nx">level</span> <span class="o">or</span> <span class="o">not</span> <span class="nx">node</span><span class="p">.</span><span class="nx">right</span>
      <span class="nv">extremes.right = </span><span class="nx">leftExtremes</span><span class="p">.</span><span class="nx">right</span>
      <span class="nx">extremes</span><span class="p">.</span><span class="nx">right</span><span class="p">.</span><span class="nx">offset</span> <span class="o">-=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">offset</span>
    <span class="k">else</span>
      <span class="nv">extremes.right = </span><span class="nx">rightExtremes</span><span class="p">.</span><span class="nx">right</span>
      <span class="nx">extremes</span><span class="p">.</span><span class="nx">right</span><span class="p">.</span><span class="nx">offset</span> <span class="o">+=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">offset</span></pre></div></span>                      </li>                              <li id="section-45">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>                           

<p>If the subtrees have uneven heights, check to see if they need to be 
threaded.  If threading is required, it will affect only one node.</p>

             </span>                          <span class="content"><div class="highlight"><pre>    <span class="k">if</span> <span class="nx">left</span> <span class="o">and</span> <span class="nx">left</span> <span class="o">!=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">left</span>
      <span class="nv">rightExtremes.right.thread = </span><span class="nx">left</span>
      <span class="nv">rightExtremes.right.offset = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="p">(</span><span class="nx">rightExtremes</span><span class="p">.</span><span class="nx">right</span><span class="p">.</span><span class="nx">offset</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">offset</span><span class="p">)</span> <span class="o">-</span> <span class="nx">leftOffsetSum</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">right</span> <span class="o">and</span> <span class="nx">right</span> <span class="o">!=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">right</span>
      <span class="nv">leftExtremes.left.thread = </span><span class="nx">right</span>
      <span class="nv">leftExtremes.left.offset = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="p">(</span><span class="nx">leftExtremes</span><span class="p">.</span><span class="nx">left</span><span class="p">.</span><span class="nx">offset</span> <span class="o">-</span> <span class="nx">node</span><span class="p">.</span><span class="nx">offset</span><span class="p">)</span> <span class="o">-</span> <span class="nx">rightOffsetSum</span></pre></div></span>                      </li>                              <li id="section-46">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>                           

<p>Return this</p>

             </span>                          <span class="content"><div class="highlight"><pre>    <span class="nx">@</span></pre></div></span>                      </li>                              <li id="section-47">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>                           

<p>Transform relative to absolute coordinates, and measure the bounds of the tree.
Return a measurement of the tree in output units.</p>             </span>                          <span class="content"><div class="highlight"><pre>  <span class="nv">transform: </span><span class="nf">(node, x=0,unitMultiplier=1,measure) -&gt;</span>
    <span class="nv">measure = </span><span class="p">{</span><span class="nx">minX</span><span class="o">:</span><span class="mi">10000</span><span class="p">,</span> <span class="nx">maxX</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span> <span class="nx">minY</span><span class="o">:</span><span class="mi">10000</span><span class="p">,</span> <span class="nv">maxY: </span><span class="mi">0</span><span class="p">}</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">measure</span>
    <span class="k">return</span> <span class="nx">measure</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">node</span>
    <span class="nv">node.x = </span><span class="nx">x</span> <span class="o">*</span> <span class="nx">unitMultiplier</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">y</span> <span class="o">*=</span> <span class="nx">unitMultiplier</span>
    <span class="nx">@transform</span> <span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">x</span> <span class="o">-</span> <span class="nx">node</span><span class="p">.</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">unitMultiplier</span><span class="p">,</span> <span class="nx">measure</span>
    <span class="nx">@transform</span> <span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">unitMultiplier</span><span class="p">,</span> <span class="nx">measure</span>
    <span class="nv">measure.minY = </span><span class="nx">node</span><span class="p">.</span><span class="nx">y</span> <span class="k">if</span> <span class="nx">measure</span><span class="p">.</span><span class="nx">minY</span> <span class="o">&gt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">y</span>
    <span class="nv">measure.maxY = </span><span class="nx">node</span><span class="p">.</span><span class="nx">y</span> <span class="k">if</span> <span class="nx">measure</span><span class="p">.</span><span class="nx">maxY</span> <span class="o">&lt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">y</span>
    <span class="nv">measure.minX = </span><span class="nx">node</span><span class="p">.</span><span class="nx">x</span> <span class="k">if</span> <span class="nx">measure</span><span class="p">.</span><span class="nx">minX</span> <span class="o">&gt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">x</span>
    <span class="nv">measure.maxX = </span><span class="nx">node</span><span class="p">.</span><span class="nx">x</span> <span class="k">if</span> <span class="nx">measure</span><span class="p">.</span><span class="nx">maxX</span> <span class="o">&lt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">x</span>
    <span class="nv">measure.width = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">measure</span><span class="p">.</span><span class="nx">minX</span> <span class="o">-</span> <span class="nx">measure</span><span class="p">.</span><span class="nx">maxX</span>
    <span class="nv">measure.height = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">measure</span><span class="p">.</span><span class="nx">minY</span> <span class="o">-</span> <span class="nx">measure</span><span class="p">.</span><span class="nx">maxY</span>
    <span class="nv">measure.centerX = </span><span class="nx">measure</span><span class="p">.</span><span class="nx">minX</span> <span class="o">+</span> <span class="nx">measure</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="nv">measure.centerY = </span><span class="nx">measure</span><span class="p">.</span><span class="nx">minY</span> <span class="o">+</span> <span class="nx">measure</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="nx">measure</span>

</pre></div></span>                      </li>              </ul>    </div> </body> </html> 