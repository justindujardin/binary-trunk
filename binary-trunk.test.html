<!DOCTYPE html>  <html> <head>   <title>binary-trunk.test.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <ul class="sections">           <li id="title">             <span class="annotation">                 <h1>binary-trunk.test.coffee</h1>             </span>         </li>                              <li id="section-1">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                           <p>This is the test-suite for <a href="./index.html">binary-trunk</a>.</p>

             </span>                      </li>                              <li id="section-2">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>                           

<h2>Binary Tree Node</h2>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">module</span> <span class="s">&#39;BinaryTrees&#39;</span></pre></div></span>                      </li>                              <li id="section-3">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>                           

<p><strong>should accept children in the constructor</strong></p>

             </span>                      </li>                              <li id="section-4">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>                           

<p>check that the children passed in the constructor are properly assigned,
and that their <code>parent</code> variables are also set to the root node properly.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeNode.constructor&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeNode</span> <span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeNode</span><span class="p">,</span> <span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeNode</span>
  <span class="nx">equal</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">left</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">and</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">right</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s">&#39;children assigned properly by constructor&#39;</span>
  <span class="nv">count = </span><span class="mi">0</span> 
  <span class="nx">tree</span><span class="p">.</span><span class="nx">visitInorder</span> <span class="nf">(node) -&gt;</span> <span class="nx">count</span><span class="o">++</span>
  <span class="nx">equal</span> <span class="nx">count</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s">&#39;expected tree node count&#39;</span>
  <span class="nx">equal</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">left</span><span class="p">.</span><span class="nx">parent</span> <span class="o">is</span> <span class="nx">tree</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> 
    <span class="s">&#39;left child parent assigned properly&#39;</span>
  <span class="nx">equal</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">right</span><span class="p">.</span><span class="nx">parent</span> <span class="o">is</span> <span class="nx">tree</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> 
    <span class="s">&#39;right child parent assigned properly&#39;</span></pre></div></span>                      </li>                              <li id="section-5">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>                           

<p><strong>should be able to be cloned to form copies of existing trees</strong></p>

             </span>                      </li>                              <li id="section-6">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>                           

<p>check to be sure that when we clone off a known node of the tree
that its children, and only its children, are still searchable 
from the cloned tree.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeNode.clone&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinarySearchTree</span> <span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">i</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">25</span><span class="p">]</span>
  <span class="nv">fifteen = </span><span class="nx">tree</span><span class="p">.</span><span class="nx">find</span> <span class="mi">15</span>
  <span class="nx">equal</span> <span class="nx">fifteen</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s">&#39;find isolation node&#39;</span>
  <span class="nv">clone = </span><span class="nx">fifteen</span><span class="p">.</span><span class="nx">clone</span><span class="p">()</span>
  <span class="nx">equal</span> <span class="nx">clone</span><span class="p">.</span><span class="nx">getRoot</span><span class="p">()</span> <span class="o">==</span> <span class="nx">clone</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s">&#39;clone node becomes root&#39;</span>
  <span class="nv">count = </span><span class="mi">0</span>
  <span class="nx">clone</span><span class="p">.</span><span class="nx">visitInorder</span> <span class="nf">-&gt;</span> <span class="nx">count</span><span class="o">++</span>
  <span class="nx">equal</span> <span class="nx">count</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> 
    <span class="s">&#39;clone node has expected 11 remaining nodes&#39;</span></pre></div></span>                      </li>                              <li id="section-7">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>                           

<p><strong>should support identifying as a leaf node</strong></p>

             </span>                      </li>                              <li id="section-8">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>                           

<p>check that the known extremes of a tree are reported as leaf nodes
and that all other known non-extremes are not.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeNode.isLeaf&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinarySearchTree</span> <span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">i</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">..</span><span class="mi">5</span><span class="p">]</span>
  <span class="nx">equal</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="nx">isLeaf</span><span class="p">(),</span> <span class="kc">true</span><span class="p">,</span> 
    <span class="s">&#39;left leaf&#39;</span>
  <span class="nx">equal</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="nx">isLeaf</span><span class="p">(),</span> <span class="kc">true</span><span class="p">,</span> 
    <span class="s">&#39;right leaf&#39;</span>    
  <span class="nx">equal</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">n</span><span class="p">).</span><span class="nx">isLeaf</span><span class="p">(),</span> <span class="kc">false</span> <span class="k">for</span> <span class="nx">n</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">4</span><span class="p">]</span></pre></div></span>                      </li>                              <li id="section-9">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>                           

<p><strong>should support node rotations</strong></p>

             </span>                      </li>                              <li id="section-10">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>                           

<p>test to ensure that rotations do not compromise the search tree
by randomly rotating nodes, and verifying that all known numbers
can still be found.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeNode.rotate&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nv">values = </span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">..</span><span class="mi">5</span><span class="p">]</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinarySearchTree</span> <span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">i</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">values</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">..</span><span class="mi">10000</span><span class="p">]</span>
    <span class="nv">index = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
    <span class="nv">node = </span><span class="nx">tree</span><span class="p">.</span><span class="nx">find</span> <span class="nx">values</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">rotate</span><span class="p">()</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">getSide</span> <span class="nx">node</span> <span class="k">if</span> <span class="nx">node</span><span class="p">.</span><span class="nx">parent</span> 
  <span class="nx">equal</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span> <span class="k">for</span> <span class="nx">v</span> <span class="k">in</span> <span class="nx">values</span></pre></div></span>                      </li>                              <li id="section-11">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>                           

<p><strong>should support preorder visiting</strong></p>

             </span>                      </li>                              <li id="section-12">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>                           

<p>check the order in which the nodes are visited against what is 
expected for a preorder tree visit.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeNode.visitPreorder&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span> 
  <span class="nv">values = </span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
  <span class="nv">order = </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinarySearchTree</span> <span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">i</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">values</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">visitPreorder</span> <span class="nf">(node) -&gt;</span> 
    <span class="nx">equal</span> <span class="nx">node</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="nx">order</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span></pre></div></span>                      </li>                              <li id="section-13">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>                           

<p>check that returning <code>node.STOP</code> cancels visits.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeNode.visit[Pre/In/Post]order (Stop)&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nv">values = </span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinarySearchTree</span> <span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">i</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">values</span>

  <span class="nv">total = </span><span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">visitPreorder</span> <span class="nf">(node) -&gt;</span>
    <span class="nx">total</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span> <span class="k">if</span> <span class="nx">node</span><span class="p">.</span><span class="nx">key</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
  <span class="nx">equal</span> <span class="nx">total</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;preorder stops at second node&#39;</span>

  <span class="nv">total = </span><span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">visitInorder</span> <span class="nf">(node) -&gt;</span>
    <span class="nx">total</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span> <span class="k">if</span> <span class="nx">node</span><span class="p">.</span><span class="nx">key</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
  <span class="nx">equal</span> <span class="nx">total</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;inorder stops at first node&#39;</span>

  <span class="nv">total = </span><span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">visitPostorder</span> <span class="nf">(node) -&gt;</span>
    <span class="nx">total</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BT</span><span class="p">.</span><span class="nx">STOP</span> <span class="k">if</span> <span class="nx">node</span><span class="p">.</span><span class="nx">key</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
  <span class="nx">equal</span> <span class="nx">total</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;postorder stops at first node&#39;</span></pre></div></span>                      </li>                              <li id="section-14">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>                           

<p><strong>should support inorder visiting</strong></p>

             </span>                      </li>                              <li id="section-15">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>                           

<p>check the order in which the nodes are visited against what is 
expected for a inorder tree visit.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeNode.visitInorder&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nv">values = </span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
  <span class="nv">order = </span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinarySearchTree</span> <span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">i</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">values</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">visitInorder</span> <span class="nf">(node) -&gt;</span> 
    <span class="nx">equal</span> <span class="nx">node</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="nx">order</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span></pre></div></span>                      </li>                              <li id="section-16">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>                           

<p><strong>should support postorder visiting</strong></p>

             </span>                      </li>                              <li id="section-17">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>                           

<p>check the order in which the nodes are visited against what is 
expected for a postorder tree visit.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeNode.visitPostorder&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nv">values = </span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
  <span class="nv">order = </span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinarySearchTree</span> <span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">i</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">values</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">visitPostorder</span> <span class="nf">(node) -&gt;</span> 
    <span class="nx">equal</span> <span class="nx">node</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="nx">order</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span></pre></div></span>                      </li>                              <li id="section-18">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>                           

<p><strong>should have a convenience for root location</strong></p>

             </span>                      </li>                              <li id="section-19">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>                           

<p>verify that <code>getRoot</code> is working as expected by checking that
every node in the tree returns the same value when it is invoked.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeNode.getRoot&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nv">values = </span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">..</span><span class="mi">5</span><span class="p">]</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinarySearchTree</span> <span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">i</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">values</span>
  <span class="nx">equal</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">n</span><span class="p">).</span><span class="nx">getRoot</span><span class="p">()</span> <span class="o">is</span> <span class="nx">tree</span><span class="p">,</span> <span class="kc">true</span> <span class="k">for</span> <span class="nx">n</span> <span class="k">in</span> <span class="nx">values</span></pre></div></span>                      </li>                              <li id="section-20">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>                           

<p><strong>should have a left child setter</strong></p>

             </span>                      </li>                              <li id="section-21">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>                           

<p>verify that the left child setter properly assigns parent link.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeNode.setLeft&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span> 
  <span class="nv">one = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeNode</span> 
  <span class="nv">two = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeNode</span>
  <span class="nx">one</span><span class="p">.</span><span class="nx">setLeft</span> <span class="nx">two</span>
  <span class="nx">equal</span> <span class="nx">one</span><span class="p">.</span><span class="nx">left</span> <span class="o">is</span> <span class="nx">two</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> 
    <span class="s">&#39;left child is expected&#39;</span>
  <span class="nx">equal</span> <span class="nx">two</span><span class="p">.</span><span class="nx">parent</span> <span class="o">is</span> <span class="nx">one</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s">&#39;parent is properly assigned&#39;</span></pre></div></span>                      </li>                              <li id="section-22">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>                           

<p><strong>should have a right child setter</strong></p>

             </span>                      </li>                              <li id="section-23">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>                           

<p>verify that the right child setter properly assigns parent link.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeNode.setRight&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span> 
  <span class="nv">one = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeNode</span> 
  <span class="nv">two = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeNode</span>
  <span class="nx">one</span><span class="p">.</span><span class="nx">setRight</span> <span class="nx">two</span>
  <span class="nx">equal</span> <span class="nx">one</span><span class="p">.</span><span class="nx">right</span> <span class="o">is</span> <span class="nx">two</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> 
    <span class="s">&#39;left child is expected&#39;</span>
  <span class="nx">equal</span> <span class="nx">two</span><span class="p">.</span><span class="nx">parent</span> <span class="o">is</span> <span class="nx">one</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s">&#39;parent is properly assigned&#39;</span></pre></div></span>                      </li>                              <li id="section-24">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>                           

<p><strong>should be able to return which side of a parent this node is on</strong></p>

             </span>                      </li>                              <li id="section-25">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>                           

<p>check that a node reports the side as expected from a tree with a 
known structure.  Because of the insertion order all numbers less 
than 0 should be left children of their parents, and all numbers 
greater than 0 should be right children of theirs.</p>

<p>In the event that a node is passed that is not a child, an exception
will be thrown.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeNode.getSide&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nv">values = </span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinarySearchTree</span> <span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">i</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">values</span>
  <span class="nv">node = </span><span class="nx">tree</span><span class="p">.</span><span class="nx">find</span> <span class="o">-</span><span class="mi">4</span>
  <span class="nx">equal</span> <span class="nx">node</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">getSide</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span> <span class="s">&#39;left&#39;</span><span class="p">,</span> 
    <span class="s">&#39;found child on expected side of parent&#39;</span> 
  <span class="nv">node = </span><span class="nx">tree</span><span class="p">.</span><span class="nx">find</span> <span class="mi">4</span>
  <span class="nx">equal</span> <span class="nx">node</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">getSide</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span> <span class="s">&#39;right&#39;</span><span class="p">,</span> 
    <span class="s">&#39;found child on expected side of parent&#39;</span>
  <span class="nx">raises</span> <span class="nf">-&gt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">getSide</span><span class="p">(</span><span class="nx">tree</span><span class="p">)</span></pre></div></span>                      </li>                              <li id="section-26">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>                           

<p><strong>should be able to set a child to a given side by side name</strong></p>

             </span>                      </li>                              <li id="section-27">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>                           

<p>check that a child node, assigned with <code>setSide</code> is assigned to 
the proper left or right node on the new parent.</p>

<p>check that an exception is thrown when a bad side string is passed.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeNode.setSide&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeNode</span>
  <span class="nv">one = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeNode</span>
  <span class="nv">two = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeNode</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">setSide</span> <span class="nx">one</span><span class="p">,</span> <span class="s">&#39;left&#39;</span>
  <span class="nx">equal</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">left</span> <span class="o">is</span> <span class="nx">one</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> 
    <span class="s">&#39;child assigned to left properly&#39;</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">setSide</span> <span class="nx">two</span><span class="p">,</span> <span class="s">&#39;right&#39;</span>
  <span class="nx">equal</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">right</span> <span class="o">is</span> <span class="nx">two</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> 
    <span class="s">&#39;child assigned to right properly&#39;</span>
  <span class="nx">raises</span> <span class="nf">-&gt;</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">setSide</span> <span class="nx">node</span><span class="p">,</span> <span class="s">&#39;rihgt&#39;</span></pre></div></span>                      </li>                              <li id="section-28">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>                           

<p><strong>should be able to return children as a list</strong></p>

             </span>                      </li>                              <li id="section-29">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>                           

<p>check a few permutations of expected results from getChildren.  </p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeNode.getChildren&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nv">values = </span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinarySearchTree</span> <span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">i</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">values</span> 
  <span class="nv">neg = </span><span class="nx">tree</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">).</span><span class="nx">getChildren</span><span class="p">()</span>
  <span class="nx">equal</span> <span class="nx">neg</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;expect two children of -1&#39;</span>
  <span class="nx">equal</span> <span class="nx">neg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">key</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s">&#39;expect left child of -1 to first&#39;</span>
  <span class="nx">equal</span> <span class="nx">neg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">key</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;expect right child of -1 to second&#39;</span>
  <span class="nv">one = </span><span class="nx">tree</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">getChildren</span><span class="p">()</span>
  <span class="nx">equal</span> <span class="nx">one</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;expect one child of 1&#39;</span>
  <span class="nx">equal</span> <span class="nx">one</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">key</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;expect child of 1 to be 2&#39;</span>
  <span class="nv">two = </span><span class="nx">tree</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nx">getChildren</span><span class="p">()</span>
  <span class="nx">equal</span> <span class="nx">two</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;expect no children for 2&#39;</span></pre></div></span>                      </li>                              <li id="section-30">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>                           

<p><strong>should have a convenience for getting a node's sibling</strong></p>

             </span>                      </li>                              <li id="section-31">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>                           

<p>check that siblings are reported properly for a known tree
structure.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeNode.getSibling&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeNode</span> <span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeNode</span><span class="p">,</span> <span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeNode</span>
  <span class="nx">equal</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">left</span><span class="p">.</span><span class="nx">getSibling</span><span class="p">()</span> <span class="o">is</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s">&#39;left sibling is right&#39;</span> 
  <span class="nx">equal</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">right</span><span class="p">.</span><span class="nx">getSibling</span><span class="p">()</span> <span class="o">is</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s">&#39;right sibling is left&#39;</span> 
  <span class="nx">equal</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">getSibling</span><span class="p">(),</span> <span class="kc">undefined</span><span class="p">,</span> 
    <span class="s">&#39;root has no sibling&#39;</span></pre></div></span>                      </li>                              <li id="section-32">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>                           

<h2>Binary Search Tree</h2>

             </span>                      </li>                              <li id="section-33">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>                           

<p><strong>should insert values into tree</strong></p>

             </span>                      </li>                              <li id="section-34">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>                           

<p>Check that after a known number of inserts, there are the expected
number of nodes in the tree.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinarySearchTree.insert&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinarySearchTree</span> <span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">i</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">25</span><span class="p">..</span><span class="mi">25</span><span class="p">]</span>
  <span class="nv">count = </span><span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">visitInorder</span> <span class="nf">(node) -&gt;</span> <span class="nx">count</span><span class="o">++</span>
  <span class="nx">equal</span> <span class="nx">count</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span>
    <span class="s">&#39;expect 51 nodes in search tree after 51 value inserts&#39;</span>
  </pre></div></span>                      </li>                              <li id="section-35">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>                           

<p><strong>should find nodes by key</strong></p>

             </span>                      </li>                              <li id="section-36">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>                           

<p>check that after known inserts, find returns the expected results,
and that invalid finds return null.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinarySearchTree.find&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinarySearchTree</span> <span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">i</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span><span class="mi">1337</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
  
  <span class="nx">equal</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="o">-</span><span class="mi">25</span><span class="p">)</span>  <span class="o">!=</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span>
  <span class="nx">equal</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="mi">1337</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span>
  <span class="nx">equal</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="o">!=</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span>

  <span class="nx">equal</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span> <span class="o">==</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span>
  <span class="nx">equal</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="o">-</span><span class="mi">33</span><span class="p">)</span>  <span class="o">==</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span>
  <span class="nx">equal</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>   <span class="o">==</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span></pre></div></span>                      </li>                              <li id="section-37">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>                           

<h2>Visual Tree Layout</h2>

             </span>                      </li>                              <li id="section-38">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>                           

<p><strong>should layout tree without error</strong></p>

             </span>                      </li>                              <li id="section-39">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>                           

<p>check that the tidier tree layout algorithm succeeds without exception,
and that it returns a non-null result.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeTidier.layout&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinarySearchTree</span> <span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">val</span> <span class="k">for</span> <span class="nx">val</span> <span class="k">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">..</span><span class="mi">100</span><span class="p">]</span>
  <span class="nv">result = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeTidier</span><span class="p">().</span><span class="nx">layout</span> <span class="nx">tree</span>
  <span class="nx">equal</span> <span class="nx">result</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s">&#39;expect a result from tidier layout pass&#39;</span>
  <span class="nx">@</span></pre></div></span>                      </li>                              <li id="section-40">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>                           

<p><strong>should satisfy 'y-coordinate sharing' aesthetic</strong></p>

             </span>                      </li>                              <li id="section-41">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>                           

<p>check that aesthetic 1 is satisfied by: building a tree, gathering up all 
the nodes, grouping them by their depth, and then asserting that each node
in a depth group has the same y-coordinate.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeTidier.layout (Aesthetic 1)&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinarySearchTree</span> <span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">val</span> <span class="k">for</span> <span class="nx">val</span> <span class="k">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">..</span><span class="mi">5</span><span class="p">]</span>
  <span class="nv">tidier = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeTidier</span>
  <span class="nx">tidier</span><span class="p">.</span><span class="nx">layout</span> <span class="nx">tree</span>
  <span class="nv">nodeGroups = </span><span class="p">{}</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">visitPreorder</span> <span class="nf">(node,depth) -&gt;</span> 
    <span class="nx">nodeGroups</span><span class="p">[</span><span class="nx">depth</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">nodeGroups</span><span class="p">[</span><span class="nx">depth</span><span class="p">]</span>
    <span class="nx">nodeGroups</span><span class="p">[</span><span class="nx">depth</span><span class="p">].</span><span class="nx">push</span> <span class="nx">node</span>
  <span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="k">of</span> <span class="nx">nodeGroups</span>
    <span class="nv">yCoords = </span><span class="nx">_</span><span class="p">.</span><span class="nx">map</span> <span class="nx">v</span><span class="p">,</span> <span class="nf">(node) -&gt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">y</span>
    <span class="nx">equal</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniq</span><span class="p">(</span><span class="nx">yCoords</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> 
      <span class="s">&#39;nodes in depth group share y-coordinate&#39;</span>
  <span class="nx">@</span></pre></div></span>                      </li>                              <li id="section-42">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>                           

<p><strong>should satisfy 'children relative position' aesthetic</strong></p>

             </span>                      </li>                              <li id="section-43">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>                           

<p>check that aesthetic 2 is satisfied by: building a tree, visiting each 
node, asserting that its left and right children are positioned to the 
left and right of it.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeTidier.layout (Aesthetic 2)&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinarySearchTree</span> <span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">val</span> <span class="k">for</span> <span class="nx">val</span> <span class="k">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
  <span class="nv">tidier = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeTidier</span>
  <span class="nx">tidier</span><span class="p">.</span><span class="nx">layout</span> <span class="nx">tree</span>
  <span class="nv">nodes = </span><span class="p">[]</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">visitPostorder</span> <span class="nf">(node) -&gt;</span>
   <span class="nv">parent = </span><span class="nx">node</span><span class="p">.</span><span class="nx">parent</span>
   <span class="k">return</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">parent</span>
   <span class="nv">side = </span><span class="nx">node</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">getSide</span> <span class="nx">node</span>
   <span class="k">if</span> <span class="nx">side</span> <span class="o">==</span> <span class="s">&#39;left&#39;</span>
      <span class="nx">equal</span> <span class="nx">node</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span>
         <span class="s">&quot;Left child (</span><span class="si">#{</span><span class="nx">node</span><span class="p">.</span><span class="nx">x</span><span class="si">}</span><span class="s">) positioned to the left of its parent (</span><span class="si">#{</span><span class="nx">node</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">x</span><span class="si">}</span><span class="s">)&quot;</span>
   <span class="k">else</span>
      <span class="nx">equal</span> <span class="nx">node</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span>
         <span class="s">&quot;Right child (</span><span class="si">#{</span><span class="nx">node</span><span class="p">.</span><span class="nx">x</span><span class="si">}</span><span class="s">) positioned to the right of its parent (</span><span class="si">#{</span><span class="nx">node</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">x</span><span class="si">}</span><span class="s">)&quot;</span>
  <span class="nx">@</span></pre></div></span>                      </li>                              <li id="section-44">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>                           

<p><strong>should satisfy 'equidistant children' aesthetic</strong></p>

             </span>                      </li>                              <li id="section-45">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>                           

<p>check that aesthetic 3 is satisfied by: building a tree, visiting each 
node, and if it's a non-root node, checking that its children are 
equidistant from it.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeTidier.layout (Aesthetic 3)&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nv">tidier = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeTidier</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinarySearchTree</span> <span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">val</span> <span class="k">for</span> <span class="nx">val</span> <span class="k">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
  <span class="nx">tidier</span><span class="p">.</span><span class="nx">layout</span> <span class="nx">tree</span>
  <span class="nv">nodes = </span><span class="p">[]</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">visitPostorder</span> <span class="nf">(node) -&gt;</span>
    <span class="nv">children = </span><span class="nx">node</span><span class="p">.</span><span class="nx">getChildren</span><span class="p">()</span>
    <span class="k">return</span> <span class="k">if</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">2</span>
    <span class="nv">left = </span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">x</span>
    <span class="nv">right = </span><span class="nx">children</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">x</span>
    <span class="nv">expected = </span><span class="nx">left</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="nx">equal</span> <span class="nx">expected</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
      <span class="s">&quot;parent node position (</span><span class="si">#{</span><span class="nx">node</span><span class="p">.</span><span class="nx">x</span><span class="si">}</span><span class="s">) matches expected&quot;</span>
  <span class="nx">@</span></pre></div></span>                      </li>                              <li id="section-46">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>                           

<p><strong>should satisfy 'subtree reflections' aesthetic</strong></p>

             </span>                      </li>                              <li id="section-47">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>                           

<p>check that aesthetic 4 reflection is satisfied by: building a tree, visiting
the nodes in the right side of the tree, and asserting that each mirrored node
on the left side is the same distance from the root as it.</p>

             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeTidier.layout (Aesthetic 4.1)&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinarySearchTree</span> <span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">val</span> <span class="k">for</span> <span class="nx">val</span> <span class="k">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">val</span> <span class="k">for</span> <span class="nx">val</span> <span class="k">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
  <span class="nv">tidier = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeTidier</span>
  <span class="nx">tidier</span><span class="p">.</span><span class="nx">layout</span> <span class="nx">tree</span>
  <span class="nv">nodes = </span><span class="p">[]</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">...</span><span class="mi">5</span><span class="p">]</span>
    <span class="nv">left = </span><span class="nx">tree</span><span class="p">.</span><span class="nx">find</span> <span class="o">-</span><span class="nx">i</span>
    <span class="nv">right = </span><span class="nx">tree</span><span class="p">.</span><span class="nx">find</span> <span class="nx">i</span>
    <span class="nv">leftDist = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">left</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">x</span>
    <span class="nv">rightDist = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">right</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">x</span>
    <span class="nx">equal</span> <span class="nx">leftDist</span><span class="p">,</span><span class="nx">rightDist</span><span class="p">,</span>
      <span class="s">&#39;Reflected nodes should be equidistant from root&#39;</span></pre></div></span>                      </li>                              <li id="section-48">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>                           

<p><strong>should satisfy 'subtree identical regardless of position' aesthetic</strong></p>

             </span>                      </li>                              <li id="section-49">             <span class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>                           

<p>check that aesthetic 4 position independence is satisfied by: building a tree, 
picking known nodes that are identical but in different positions of the tree,
and ensuring that their children are positioned the same.</p>             </span>                          <span class="content"><div class="highlight"><pre><span class="nx">test</span> <span class="s">&#39;BinaryTreeTidier.layout (Aesthetic 4.2)&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nv">tree = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinarySearchTree</span> <span class="mi">0</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">val</span> <span class="k">for</span> <span class="nx">val</span> <span class="k">in</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span><span class="o">-</span><span class="mi">13</span><span class="p">,</span><span class="o">-</span><span class="mi">14</span><span class="p">,</span><span class="o">-</span><span class="mi">12</span><span class="p">]</span>
  <span class="nv">tidier       = </span><span class="k">new</span> <span class="nx">DJC</span><span class="p">.</span><span class="nx">BinaryTreeTidier</span>
  <span class="nv">result       = </span><span class="nx">tidier</span><span class="p">.</span><span class="nx">layout</span> <span class="nx">tree</span>
  <span class="nv">nodes        = </span><span class="p">[]</span>
  <span class="nv">lDistance = rDistance = </span><span class="kc">undefined</span>
  <span class="nx">tree</span><span class="p">.</span><span class="nx">visitPreorder</span> <span class="nf">(node) -&gt;</span>
    <span class="k">return</span> <span class="k">if</span> <span class="nx">node</span><span class="p">.</span><span class="nx">key</span> <span class="o">!=</span> <span class="mi">13</span> <span class="o">and</span> <span class="nx">node</span><span class="p">.</span><span class="nx">key</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">13</span>
    <span class="nx">equal</span> <span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">key</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;expect lesser value to the left&#39;</span>
    <span class="nx">equal</span> <span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">key</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;expect greater value to the right&#39;</span>
    <span class="nv">three = </span><span class="nx">node</span><span class="p">.</span><span class="nx">x</span>
    <span class="nv">less = </span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">.</span><span class="nx">x</span>
    <span class="nv">more = </span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">.</span><span class="nx">x</span>
    <span class="nv">leftDistance = </span><span class="nx">less</span> <span class="o">-</span> <span class="nx">three</span>
    <span class="nv">rightDistance = </span><span class="nx">more</span> <span class="o">-</span> <span class="nx">three</span>
    <span class="k">if</span> <span class="nx">lDistance</span> <span class="o">and</span> <span class="nx">rDistance</span>
      <span class="nx">equal</span> <span class="nx">lDistance</span><span class="p">,</span> <span class="nx">leftDistance</span><span class="p">,</span>
        <span class="s">&#39;left child distances match&#39;</span>
      <span class="nx">equal</span> <span class="nx">rDistance</span><span class="p">,</span> <span class="nx">rightDistance</span><span class="p">,</span>
        <span class="s">&#39;right child distances match&#39;</span>
    <span class="nv">lDistance = </span><span class="nx">leftDistance</span>
    <span class="nv">rDistance = </span><span class="nx">rightDistance</span>
  <span class="nx">@</span>

</pre></div></span>                      </li>              </ul>    </div> </body> </html> 